{% extends "layout.html" %}
{% block css-area %}
<link rel="stylesheet" href="/assets/css/pagedown.css">
<link rel="stylesheet" href="/assets/css/edit.css">
{% end %}
{% block main %}
<div class="editor-main container-fluid clearfix edit-panel">
    <label><h3>编辑文章</h3></label>
    <div class="row">
        <div class="col-md-12">
            <div class="form-group">
                {% if post %}
                <input class="form-control" type="text" name="title" value={{ post.title }} placeholder="输入文章标题" autofocus>
                {% else %}
                <input class="form-control" type="text" name="title" placeholder="输入文章标题" autofocus>
                {% end %}
                <span class="glyphicon glyphicon-ok form-control-feedback hidden" aria-hidden="true"></span>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <label class="text-muted">选择文章目录：</label>
            <div class="select-cate" id="js-select-cate">
                <!--select class="category" name="category">
                    <option value="">选择文章目录</option>
                    {% for category in categories %}
                    {% if post and post.category_id == category.id %}
                    <option value={{ category.id }} selected="selected">{{ category.name }}</option>
                    {% else %}
                    <option value={{ category.id }}>{{ category.name }}</option>
                    {% end %}
                    {% end %}
                </select-->
                {% for category in categories %}
                    {% if post and post.category_id == category.id %}
                    <button class="btn btn-info btn-sm" data-id={{ category.id }}>{{ category.name }}</button>
                    <input type="hidden" name="category" value={{ category.id }}>
                    {% else %}
                    <button class="btn btn-default btn-sm" data-id={{ category.id }}>{{ category.name }}</button>
                    {% end %}
                {% end %}
            </div>
            <div class="create-cate">
                <button id="js-add-cate" class="btn btn-default btn-sm" data-container="body" data-toggle="popover" data-placement="bottom" data-trigger="click">添加新目录</button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <div class="select-privacy" id="js-select-privacy">
                <label class="text-muted">是否对外公开：</label>
                {% if post and ord(post.public) %}
                <div class="btn-group" role="group" aria-label="...">
                    <button type="button" class="btn btn-danger btn-sm left-switch" data-value="1"><span class="glyphicon glyphicon-eye-open"></span> 公开</button>
                    <button type="button" class="btn btn-default btn-sm right-switch" data-value="0"><span class="glyphicon glyphicon-eye-close"></span> 禁止</button>
                </div>
                <input type="hidden" name="privacy" value="1">
                {% elif post and not ord(post.public) %}
                <div class="btn-group" role="group" aria-label="...">
                    <button type="button" class="btn btn-default btn-sm left-switch" data-value="1"><span class="glyphicon glyphicon-eye-open"></span> 公开</button>
                    <button type="button" class="btn btn-danger btn-sm right-switch" data-value="0"><span class="glyphicon glyphicon-eye-close"></span> 禁止</button>
                </div>
                <input type="hidden" name="privacy" value="0">
                {% elif not post %}
                <div class="btn-group" role="group" aria-label="...">
                    <button type="button" class="btn btn-default btn-sm left-switch" data-value="1"><span class="glyphicon glyphicon-eye-open"></span> 公开</button>
                    <button type="button" class="btn btn-default btn-sm right-switch" data-value="0"><span class="glyphicon glyphicon-eye-close"></span> 禁止</button>
                </div>
                <input type="hidden" name="privacy" value="-1">
                {% end %}

                <!--
                {% if post and ord(post.public) %}
                <label class="radio-inline">
                    <input name="public" type="radio" value="1" checked>是
                </label>
                <label class="radio-inline">
                    <input name="public" type="radio" value="0">否
                </label>
                {% elif post and not ord(post.public) %}
                <label class="radio-inline">
                    <input name="public" type="radio" value="1">是
                </label>
                <label class="radio-inline">
                    <input name="public" type="radio" value="0" checked>否
                </label>
                {% elif not post %}
                <label class="radio-inline">
                    <input name="public" type="radio" value="1" checked>是
                </label>
                <label class="radio-inline">
                    <input name="public" type="radio" value="0">否
                </label>
                {% end %}
                -->
            </div>
        </div>
    </div>
    <!--div class="row">
        <div class="col-md-12">
            <label class="text-muted">是否对外公开：</label>
            {% if post and ord(post.public) %}
            <label class="radio-inline">
                <input name="public" type="radio" value="1" checked>是
            </label>
            <label class="radio-inline">
                <input name="public" type="radio" value="0">否
            </label>
            {% elif post and not ord(post.public) %}
            <label class="radio-inline">
                <input name="public" type="radio" value="1">是
            </label>
            <label class="radio-inline">
                <input name="public" type="radio" value="0" checked>否
            </label>
            {% elif not post %}
            <label class="radio-inline">
                <input name="public" type="radio" value="1" checked>是
            </label>
            <label class="radio-inline">
                <input name="public" type="radio" value="0">否
            </label>
            {% end %}
        </div>
    </div-->
    <!--ul class="nav nav-tabs">
        <li class="switch-editor-mode active" data-mode="edit" role="presentation"><a href="javascript:;">编辑</a></li>
        <li class="switch-editor-mode" data-mode="preview" role="presentation"><a href="javascript:;">预览</a></li>
    </ul-->
    <div class="row">
        <div class="editor-notice text-danger">
            暂时只支持<a href="http://daringfireball.net/projects/markdown/syntax" target="_blank">Markdown</a>语法
        </div>
        <div class="editor-area col-md-6">
            <div class="editor-header" id="wmd-button-bar"></div>
            <div class="editor-body">
                <textarea id="wmd-input" name="content" class="form-control">{% if post %}{{ post.content }}{% end %}</textarea>
            </div>
            <div class="editor-footer clearfix">
                <div class="pull-right">
                    <button class="btn btn-orange draft-btn">存为草稿</button>
                    {% if post %}
                    <button class="btn btn-main submit-btn">确认修改</button>
                    {% else %}
                    <button class="btn btn-main submit-btn">立即发布</button>
                    {% end %}
                </div>
            </div>
        </div>
        <div class="editor-preview col-md-6">
            <div id="wmd-preview" class="preview-body"></div>
        </div>
    </div>
    {% if post %}
    <input type="hidden" name="id" value={{ post.id }}>
    {% else %}
    <input type="hidden" name="id" value="-1">
    <input type="hidden" name="category" value="-1">
    {% end %}
</div>
<!--div class="btns-dialog container-fluid"></div-->
<input type="hidden" name="referer" value={{ referer }}>
<div class="modal fade" id="js-add-cate-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Modal title</h4>
            </div>
            <div class="modal-body">
                <p>One fine body&hellip;</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-main">添加</button>
            </div>
        </div>
    </div>
</div>
{% end %}
{% block js-area %}
<script src="/assets/lib/pagedown/Markdown.Converter.js" type="text/javascript"></script>
<script src="/assets/lib/pagedown/Markdown.Sanitizer.js" type="text/javascript"></script>
<script src="/assets/lib/pagedown/Markdown.Editor.js" type="text/javascript"></script>
<script src="/assets/dist/js/edit.js" type="text/javascript"></script>
{% end %}
